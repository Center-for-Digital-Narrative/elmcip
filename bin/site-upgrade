#!/bin/bash

set -x

DRUPAL=drupal
URI=elmcip.local
HOMEDIR=${PWD}

drush --version || exit $?

# Pull latest code the master branch and selected branch before running
# upgrades.

if [[ -z "$1" ]]; then
  git checkout master
  git pull --rebase
else
  git pull --rebase
  git checkout $1
fi

git submodule update --quiet || exit $?

# Flush all drupal caches and revert all feature modules
cd ${HOMEDIR}/${DRUPAL}
drush cc all
drush updatedb --yes
drush features-revert-all --yes
drush updatedb --yes
drush cc all
drush fl
